# LLM용 Markdown 정리 가이드

## 1. 전체 아키텍처 요약
- **프론트엔드**: React Router v6, Axios, WebSocket(STOMP) Client
- **백엔드**: Spring Boot + JPA, WebSocket(STOMP), REST API
- **경로 규칙**
  - `/api/**` (REST)
  - `/ws-stomp` (WebSocket handshake)
  - `/pub/**` (클라이언트 → 서버)
  - `/sub/**` (서버 → 클라이언트)

## 2. 엔티티(Entity) 핵심 구조
- **User, Workshop, Lounge, Message**
- 각 엔티티의 PK, 주요 필드, 제약조건(nullable, unique 등) 요약
- Message의 경우 `writerId`, `writerNickname`, `isDeleted(boolean)`, `loungeId` 등이 중요

## 3. DTO 구분
- REST 전용: `SendMessageRequest`, `MessageResponse`
- WebSocket 전용: `ChatSocketRequest`, `ChatSocketResponse`
- 구분 이유: 초기 로드(REST) vs 실시간 브로드캐스트(WebSocket)

## 4. 서비스(Service) 흐름
- REST: `MessageService` → `MessageRepository` → DB
- WebSocket: `ChatSocketService.saveAndSend()`
  - User/Lounge 유효성 검증
  - Message 생성 + 저장
  - DTO 변환 → `BroadcastService.sendCreated()`

## 5. 컨트롤러(Controller) 매핑
- REST: `@PostMapping("/api/workshops/{id}/lounges/{id}/messages")` 등 CRUD
- WebSocket: `@MessageMapping("/workshops.{workshopId}.lounges.{loungeId}.send")`

## 6. 프론트엔드 흐름
- `messageAPI` (axios)로 REST 호출 (CRUD)
- STOMP Client로 `/pub/...send` 발행, `/sub/...` 구독
- 메시지 리스트 상태 업데이트 (`setMessages`)

## 7. PostMapping / GetMapping 등 데이터 흐름 표
| Method | URL | 역할 |
|--------|-----|------|
| POST   | /api/workshops/{id}/lounges/{id}/messages | 메시지 저장 |
| GET    | /api/workshops/{id}/lounges/{id}/messages | 메시지 목록 조회 |
| PATCH  | /api/workshops/{id}/lounges/{id}/messages/{messageId} | 메시지 수정 |
| DELETE | /api/workshops/{id}/lounges/{id}/messages/{messageId} | 메시지 삭제 |
| SEND   | /pub/workshops.{id}.lounges.{id}.send | 실시간 메시지 발행 |
| SUB    | /sub/workshops.{id}.lounges.{id} | 실시간 메시지 수신 |

## 8. 주의사항
- `nullable=false` 필드(DB constraint) → 반드시 값 채워야 함 (`writerNickname`, `isDeleted` 등)
- DTO 혼동 금지: REST용 vs WebSocket용 분리
- Unique 제약조건: `writerNickname`에 `unique=true` 넣으면 충돌 발생 → 필요 시 제거
- `@Transactional` 없으면 LazyLoading 예외 가능
- React에서 key 중복 주의 (`id+updatedAt` 조합 추천)
