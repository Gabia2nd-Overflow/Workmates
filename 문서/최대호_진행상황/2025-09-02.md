# 📌 Workmates - Workshop 생성 & 멤버 관리 기능 요약

## ✅ 개요
워크샵(Workshop)은 협업 메신저의 **최상위 공간**입니다.  
이번에 구현한 기능은 **워크샵 생성 시 생성자를 자동으로 멤버(WorkshopMember)에 추가**하고,  
**사용자가 속해 있는 워크샵만 조회**되도록 제한하는 로직입니다.

---

## 📦 도메인 구조

### Workshop (Entity)
- `id`: 워크샵 식별자 (PK)
- `name`: 워크샵 이름 (Unique, Not Null)
- `imageUrl`: 워크샵 아이콘 이미지
- `description`: 설명
- `isDeleted`: 소프트 삭제 여부 (기본값 false)

### User (Entity)
- `id`: 사용자 계정 ID (PK)
- `nickname`: 닉네임
- `email`: 이메일

### WorkshopMember (Entity)
- `id`: 멤버 식별자 (PK)
- `user`: 어떤 사용자인지 (User FK)
- `workshop`: 어떤 워크샵에 속했는지 (Workshop FK)
- `role`: 권한 (예: CREATOR, MEMBER)

---

## ⚙️ 기능 흐름

### 1) 워크샵 생성
1. 클라이언트가 **워크샵 생성 요청** (`POST /api/workshops`) 전송
2. 서버(Service):
   - 새 Workshop 엔티티 생성 및 저장
   - 동시에 **WorkshopMember 엔티티 생성**
     - `user = 현재 로그인한 사용자`
     - `role = CREATOR`
   - 두 엔티티를 DB에 저장
3. 응답으로 생성된 Workshop 정보 반환

---

### 2) 워크샵 조회 제한
- 기존: 모든 워크샵을 조회할 수 있었음
- 변경 후: `findAllByUserId(userId)` 방식으로 **현재 로그인한 사용자가 속한 워크샵만 조회**  
- Repository 계층 예시:
```java
@Query("SELECT wm.workshop FROM WorkshopMember wm WHERE wm.user.id = :userId AND wm.workshop.isDeleted = false")
List<Workshop> findWorkshopsByUserId(@Param("userId") String userId);
🎛 컨트롤러 & 서비스 요약
Controller
@PostMapping("/api/workshops")
public WorkshopDto.Response create(@RequestBody @Valid WorkshopDto.CreateRequest req,
                                   @AuthenticationPrincipal User user) {
    return workshopService.create(req, user);
}

@GetMapping("/api/workshops")
public List<WorkshopDto.Response> list(@AuthenticationPrincipal User user) {
    return workshopService.list(user.getId());
}

Service
@Transactional
public WorkshopDto.Response create(CreateRequest req, User user) {
    Workshop workshop = workshopRepository.save(
        Workshop.builder()
            .name(req.getWorkshopName())
            .imageUrl(req.getWorkshopIconImage())
            .description(req.getWorkshopDescription())
            .build()
    );

    workshopMemberRepository.save(
        WorkshopMember.builder()
            .user(user)
            .workshop(workshop)
            .role("CREATOR")
            .build()
    );

    return WorkshopDto.Response.from(workshop);
}

public List<WorkshopDto.Response> list(String userId) {
    return workshopMemberRepository.findWorkshopsByUserId(userId)
        .stream()
        .map(WorkshopDto.Response::from)
        .toList();
}

📑 데이터 흐름 정리

워크샵 생성 요청

프론트: Axios → POST /api/workshops

백엔드: Workshop + WorkshopMember 동시 저장

워크샵 조회

프론트: Axios → GET /api/workshops

백엔드: 로그인 유저 기준 WorkshopMember → Workshop 목록 반환

결과

생성자는 자동으로 멤버로 등록됨

사용자는 자신이 속한 워크샵만 Sidebar 등에 표시됨

📌 정리

워크샵 생성 시, 자동으로 WorkshopMember에 추가되어 팀 관리가 간단해짐

조회 제한을 걸어 보안 및 접근 제어 강화

구조는 Workshop ↔ WorkshopMember ↔ User 삼각 관계를 통해 확장성 있게 설계됨
(예: 추후 권한(Role) 부여, 초대/추방 기능 구현 가능)